<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>2BeerBotRacer</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Abel&display=swap" rel="stylesheet">
        <link href="browsersource.css" rel="stylesheet">
        <!-- <meta http-equiv="refresh" content="2"> -->
        <style type="text/css">
            
        </style>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Racing+Sans+One&display=swap');
        </style> 
        <script type="text/javascript">
            var latest_winner = "";

            function getCells(data, type) {
                cells="";
                for (const property in data) {
                    cells += `<${type}>${data[property]}</${type}>`;
                }
                return cells;
            }

            function createBody(data) {
                return data.map(row => `<tr>${getCells(row, 'td')}</tr>`).join('');
            }

            function createTable(data) {

                // Destructure the headings (first row) from
                // all the rows
                const [headings, ...rows] = data;

                // Return some HTML that uses `getCells` to create
                // some headings, but also to create the rows
                // in the tbody.
                return `
                        <thead><th colspan="2"><img class="img--logo" src="natmar.png" alt=""></th></thead>
                        <tbody>${createBody(rows)}</tbody>
                `;
            }

            function fillTable(data) {
                if (Array.isArray(data)) {
                    data.unshift({"number": "number", "name": "name"});
                    let tablerender = createTable(data);
                    document.getElementById("entries").innerHTML = tablerender;
                    // console.log("it works?");
                }
            }


            const socket = new WebSocket("ws://localhost:5678");

            function refresh_queue() {
                socket.send("send_queue");
            }

            function marqueeText() {
                return "!race to join // Latest Winner: " + latest_winner;
            }

            // Send a message to the server to trigger the queue send
            socket.onopen = function() {
                refresh_queue();
                // window.setInterval(refresh_queue, 2000);
            };

            // Receive the queue from the server
            socket.onmessage = function(event) {
                jsondata = JSON.parse(event.data);
                // console.log(jsondata);
                fillTable(jsondata);
            };
        </script>
    </head>
    <body>
        <div class="wrap">
            <table id="entries"></table>
        </div>
    </body>
</html>